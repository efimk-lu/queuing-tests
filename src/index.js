const fetch = require("node-fetch");

let globalCount = 0;
function infiniteSend(url) {
  setTimeout(() => {
    fetch(url, {
      method: "POST",
      body: JSON.stringify({
        sentTime: Date.now(),
        big: "111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111111"
      }),
      headers: { "Content-Type": "application/json" }
    })
      .then(() => {
        process.stdout.write(".");
        globalCount++;
      })
      .catch(err => {
        console.error(err);
      });
    infiniteSend(url);
  }, 5);
}

if (process.argv.length !== 3) {
  console.error("Missing url name");
  process.exit();
}
const startTime = Date.now();
process.on("SIGINT", function() {
  console.log("Caught interrupt signal");
  const timePassed = (Date.now() - startTime) / 1000;
  console.info(`On average ${globalCount / timePassed}`);
  process.exit();
});
infiniteSend(process.argv[2]);
